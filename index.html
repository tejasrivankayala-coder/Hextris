<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hextris - Advanced</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800;900&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
</head>
<body>
  <div class="game-container">
    <div id="timeUpFlash" class="timeup-flash"></div>
    <header class="header">
      <div class="hud">
        <div class="hud-row">
          <span class="hud-item lives-display">â¤ï¸ <b id="livesLabel">5</b></span>
          <span class="hud-item level-display">â­ <b id="levelLabel">1</b></span>
          <span class="hud-item timer-display">â± <b id="timer">120</b>s</span>
          <span class="hud-item best-score-display">ğŸ† <b id="bestScoreLabel">0</b></span>
          <span class="hud-item hammer-display" id="hammersDisplay">ğŸ”¨ <b id="hammersLabel">0</b></span>
          <span class="hud-item shield-display" id="shieldDisplay" style="display:none;">ğŸ›¡ï¸ <b id="shieldTimer">0</b>s</span>
          <button class="hud-btn pause-btn" id="pauseBtn" type="button" title="Pause Game">â¸</button>
          <button class="hud-btn mute-btn" id="muteBtn" type="button" title="Toggle Sound">ğŸ”Š</button>
          <div class="hud-theme-selector" id="hudThemeSelector">
            <button class="hud-theme-dot neon active-hud-theme" id="hudThemeNeon" type="button" title="Neon"><span style="background:#ff4081"></span><span style="background:#00e5ff"></span></button>
            <button class="hud-theme-dot ocean" id="hudThemeOcean" type="button" title="Ocean"><span style="background:#1b4965"></span><span style="background:#247ba0"></span></button>
            <button class="hud-theme-dot fire" id="hudThemeFire" type="button" title="Fire"><span style="background:#ff0000"></span><span style="background:#ff6600"></span></button>
          </div>
        </div>
      </div>
      <span id="timerDisplay" style="display:none;"></span>
      <span id="comboDisplay" class="combo-display" style="display:none;">COMBO x<b id="comboCount">0</b></span>
      <span id="scoreLabel" style="display:none;">0</span>
    </header>

    <main class="game-area">
      <canvas id="gameCanvas" width="600" height="600"></canvas>
      
      <!-- Main Menu -->
      <div id="menuScreen" class="overlay">
        <p class="title">â¬¡ HEXTRIS</p>
        <div class="menu-grid">
          <button id="classicBtn" type="button">Classic</button>
          <button id="timeChaserBtn" type="button">â± Time Chaser</button>
          <button id="multiplayerBtn" type="button">Multiplayer</button>
          <button id="leaderboardBtn" type="button">Leaderboard</button>
          <button id="settingsBtn" type="button">âš™ Settings</button>
          <button id="tutorialBtn" type="button">â“ How to Play</button>
          <button id="achievementsBtn" type="button">ğŸ† Achievements</button>
          <button id="statsBtn" type="button">ğŸ“Š Stats</button>
          <button id="dailyChallengeBtn" type="button">ğŸ“… Daily Challenge</button>
        </div>
        <p class="subtitle" style="margin-top:0.6rem;">Color Theme</p>
        <div class="menu-theme-row">
          <button class="menu-theme-dot neon-dot active-theme" id="menuThemeNeon" type="button" title="Neon">
            <span style="background:#ff4081"></span><span style="background:#00e5ff"></span><span style="background:#7c4dff"></span><span style="background:#ffab40"></span>
          </button>
          <button class="menu-theme-dot ocean-dot" id="menuThemeOcean" type="button" title="Ocean">
            <span style="background:#1b4965"></span><span style="background:#247ba0"></span><span style="background:#b2dbbf"></span><span style="background:#ff1654"></span>
          </button>
          <button class="menu-theme-dot fire-dot" id="menuThemeFire" type="button" title="Fire">
            <span style="background:#ff0000"></span><span style="background:#ff6600"></span><span style="background:#ffaa00"></span><span style="background:#ff3300"></span>
          </button>
        </div>
      </div>

      <!-- Time Chaser Mode Selection -->
      <div id="timerSelectScreen" class="overlay">
        <p class="title">Time Chaser</p>
        <p class="subtitle">Select Time Limit</p>
        <div class="menu-grid">
          <button id="timer30Btn" type="button">â± 30 seconds</button>
          <button id="timer60Btn" type="button">â± 60 seconds</button>
          <button id="timer90Btn" type="button">â± 90 seconds</button>
          <button id="timerBackBtn" class="tiny" type="button">Back</button>
        </div>
      </div>

      <!-- Difficulty Selection -->
      <div id="difficultyScreen" class="overlay">
        <p class="title">Select Difficulty</p>
        <div class="menu-grid">
          <button id="easyBtn" type="button">ğŸŸ¢ EASY</button>
          <button id="mediumBtn" type="button">ğŸŸ¡ MEDIUM</button>
          <button id="hardBtn" type="button">ğŸ”´ HARD</button>
          <button id="diffBackBtn" class="tiny" type="button">Back</button>
        </div>
      </div>

      <!-- Theme Selection -->
      <div id="themeScreen" class="overlay">
        <p class="title">Choose Theme</p>
        <p class="subtitle">Pick a color palette</p>
        <div class="theme-grid">
          <button id="themeNeonBtn" class="theme-btn neon-theme" type="button">
            <span class="theme-preview"><span style="background:#ff4081"></span><span style="background:#00e5ff"></span><span style="background:#7c4dff"></span><span style="background:#ffab40"></span></span>
            Neon
          </button>
          <button id="themeOceanBtn" class="theme-btn ocean-theme" type="button">
            <span class="theme-preview"><span style="background:#1b4965"></span><span style="background:#247ba0"></span><span style="background:#b2dbbf"></span><span style="background:#ff1654"></span></span>
            Ocean
          </button>
          <button id="themeFireBtn" class="theme-btn fire-theme" type="button">
            <span class="theme-preview"><span style="background:#ff0000"></span><span style="background:#ff6600"></span><span style="background:#ffaa00"></span><span style="background:#ff3300"></span></span>
            Fire
          </button>
        </div>
        <button id="themeBackBtn" class="tiny" type="button">Back</button>
      </div>

      <!-- Multiplayer Lobby -->
      <div id="multiplayerScreen" class="overlay">
        <p class="title">âš” Multiplayer</p>
        <p class="subtitle">Play online with a friend on any device</p>
        <div class="mp-lobby">
          <div class="mp-how-it-works">
            <p class="mp-info-title">ğŸŒ How it works</p>
            <p class="mp-info-text">Up to 3 players can play! All players open this game in their browser (any device, any network). One creates a room, others join with the code.</p>
          </div>
          <div class="mp-name-row">
            <label for="mpNameInput">Your Name</label>
            <input type="text" id="mpNameInput" placeholder="Enter your name" maxlength="12">
          </div>
          <div id="mpCreateJoinSection">
            <button id="createRoomBtn" type="button" class="mp-action-btn">ğŸ  Create Room</button>
            <div class="mp-or-divider"><span>OR</span></div>
            <div class="mp-join-row">
              <input type="text" id="roomCodeInput" placeholder="CODE" maxlength="4" class="mp-code-input">
              <button id="joinRoomBtn" type="button" class="mp-action-btn small">ğŸ”— Join</button>
            </div>
          </div>
          <div id="mpHostWaiting" style="display:none;">
            <div class="mp-code-display">
              <span class="mp-code-label">Room Code</span>
              <span class="mp-code-value" id="roomCodeDisplay">----</span>
              <button type="button" id="copyCodeBtn" class="mp-copy-btn">ğŸ“‹ Copy Code</button>
              <span class="mp-code-hint">Share this code with friends so they can join</span>
            </div>
            <div class="mp-players-list">
              <div class="mp-player-row">
                <span class="mp-dot" style="background:#ff6b9d;"></span>
                <span id="mpHostNameDisplay">You</span>
                <span class="mp-tag">HOST</span>
              </div>
              <div class="mp-player-row" id="mpGuest1Slot">
                <span class="mp-dot" id="mpGuest1Dot" style="background:#555;"></span>
                <span id="mpGuest1NameDisplay">Waiting...</span>
              </div>
              <div class="mp-player-row" id="mpGuest2Slot">
                <span class="mp-dot" id="mpGuest2Dot" style="background:#555;"></span>
                <span id="mpGuest2NameDisplay">Waiting...</span>
              </div>
            </div>
            <p class="mp-status" id="mpHostStatus">â³ Waiting for players (0/2)...</p>
            <button id="startOnlineMatchBtn" type="button" style="display:none;">âš” Start Match</button>
          </div>
          <div id="mpGuestWaiting" style="display:none;">
            <div class="mp-players-list">
              <div class="mp-player-row">
                <span class="mp-dot" style="background:#ff6b9d;"></span>
                <span id="mpJoinHostDisplay">Host</span>
                <span class="mp-tag">HOST</span>
              </div>
              <div class="mp-player-row">
                <span class="mp-dot" style="background:#4ecdc4;"></span>
                <span id="mpJoinGuestDisplay">You</span>
              </div>
              <div class="mp-player-row">
                <span class="mp-dot" style="background:#ffab40;"></span>
                <span>Player 3</span>
              </div>
            </div>
            <p class="mp-status" id="mpGuestStatus">ğŸ”— Connecting...</p>
          </div>
          <div id="mpErrorSection" style="display:none;">
            <p class="mp-error" id="mpErrorMsg">Connection failed</p>
            <button id="mpRetryBtn" type="button" class="tiny">Try Again</button>
          </div>
        </div>
        <button id="multiBackBtn" class="tiny" type="button" style="margin-top:1rem;">Back</button>
      </div>

      <!-- Multiplayer HUD (independent games scoreboard) -->
      <div id="mpHud" class="mp-hud" style="display:none;">
        <div class="mp-hud-timer-bar">
          <span class="mp-hud-timer">â± <b id="mpTimer">120</b>s</span>
          <button class="hud-btn" id="mpMuteBtn" type="button" title="Toggle Sound">ğŸ”Š</button>
        </div>
        <table class="mp-scoreboard">
          <thead>
            <tr>
              <th>Player</th>
              <th>Score</th>
              <th>Lives</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr class="mp-row-p1" id="mpRowP1">
              <td class="mp-sb-name" id="mpP1Name">P1</td>
              <td class="mp-sb-score" id="mpP1Score">0</td>
              <td class="mp-sb-lives" id="mpP1Lives">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</td>
              <td class="mp-sb-status" id="mpP1Status">Playing</td>
            </tr>
            <tr class="mp-row-p2" id="mpRowP2">
              <td class="mp-sb-name" id="mpP2Name">P2</td>
              <td class="mp-sb-score" id="mpP2Score">0</td>
              <td class="mp-sb-lives" id="mpP2Lives">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</td>
              <td class="mp-sb-status" id="mpP2Status">Playing</td>
            </tr>
            <tr class="mp-row-p3" id="mpRowP3">
              <td class="mp-sb-name" id="mpP3Name">P3</td>
              <td class="mp-sb-score" id="mpP3Score">0</td>
              <td class="mp-sb-lives" id="mpP3Lives">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</td>
              <td class="mp-sb-status" id="mpP3Status">Playing</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Multiplayer Results Screen -->
      <div id="mpResultScreen" class="overlay">
        <p class="title" id="mpResultTitle">ğŸ† Winner!</p>
        <div class="mp-result-grid">
          <div class="mp-result-card" id="mpResult1">
            <span class="mp-result-name" id="mpResP1Name">P1</span>
            <span class="mp-result-score" id="mpResP1Score">0</span>
          </div>
          <div class="mp-result-vs" id="mpResultVs1">VS</div>
          <div class="mp-result-card" id="mpResult2">
            <span class="mp-result-name" id="mpResP2Name">P2</span>
            <span class="mp-result-score" id="mpResP2Score">0</span>
          </div>
          <div class="mp-result-vs" id="mpResultVs2">VS</div>
          <div class="mp-result-card" id="mpResult3">
            <span class="mp-result-name" id="mpResP3Name">P3</span>
            <span class="mp-result-score" id="mpResP3Score">0</span>
          </div>
        </div>
        <div style="display:flex; gap:0.8rem; justify-content:center; margin-top:1rem;">
          <button id="mpRematchBtn" type="button">âš” Rematch</button>
          <button id="mpResultMenuBtn" class="tiny" type="button">Menu</button>
        </div>
      </div>

      <!-- Continue Screen (Lost 1 Life) -->
      <div id="continueScreen" class="overlay">
        <p class="title">Life Lost!</p>
        <p class="final-score">Current Score: <span id="continueScore">0</span></p>
        <p id="livesRemaining" class="final-stats"></p>
        <div style="display: flex; gap: 1rem; justify-content: center;">
          <button id="continueBtn" type="button">Continue (+2 min)</button>
          <button id="continueMenuBtn" class="tiny" type="button">Menu</button>
        </div>
      </div>

      <!-- Game Over Screen -->
      <div id="gameOverScreen" class="overlay">
        <p class="title">Game Over</p>
        <p id="gameOverBestBadge" class="game-over-best-badge" style="display:none;">ğŸ‘‘ New Best Score!</p>
        <p class="final-score">Final Score: <span id="finalScore">0</span></p>
        <p id="finalStats" class="final-stats">All Lives Used</p>
        <button id="restartBtn" type="button">Play Again</button>
        <button id="gameOverToMenuBtn" class="tiny" type="button">Menu</button>
      </div>

      <!-- Paused Screen -->
      <div id="pauseScreen" class="overlay">
        <p class="title">Paused</p>
        <button id="resumeBtn" type="button">Resume</button>
        <button id="pauseRestartBtn" type="button">ğŸ”„ Restart</button>
        <button class="tiny" id="pauseToMenuBtn" type="button">Menu</button>
        <div class="pause-shortcuts">
          <p class="shortcuts-title">âŒ¨ Keyboard Shortcuts</p>
          <div class="shortcut-row"><kbd>â†</kbd> <kbd>â†’</kbd> or <kbd>A</kbd> <kbd>D</kbd> <span>Rotate hexagon</span></div>
          <div class="shortcut-row"><kbd>1</kbd>â€“<kbd>9</kbd> <span>Use hammer on side</span></div>
          <div class="shortcut-row"><kbd>P</kbd> or <kbd>Esc</kbd> <span>Pause / Resume</span></div>
          <div class="shortcut-row"><kbd>M</kbd> <span>Mute / Unmute</span></div>
        </div>
      </div>

      <!-- Pause Countdown Overlay -->
      <div id="countdownOverlay" class="overlay countdown-overlay" style="display:none;">
        <p id="countdownNumber" class="countdown-number">3</p>
      </div>

      <!-- New Best Score Celebration Overlay -->
      <div id="newBestOverlay" class="new-best-overlay" style="display:none;">
        <div class="new-best-banner">
          <span class="new-best-crown">ğŸ‘‘</span>
          <span class="new-best-text">NEW BEST SCORE!</span>
          <span class="new-best-score" id="newBestScore">0</span>
        </div>
        <canvas id="confettiCanvas" class="confetti-canvas"></canvas>
      </div>

      <!-- Settings Screen -->
      <div id="settingsScreen" class="overlay">
        <p class="title">âš™ Settings</p>
        <div class="settings-panel">
          <div class="setting-row">
            <label>Music Volume</label>
            <input type="range" id="musicVolume" min="0" max="100" value="30" class="slider">
            <span id="musicVolVal" class="slider-val">30%</span>
          </div>
          <div class="setting-row">
            <label>SFX Volume</label>
            <input type="range" id="sfxVolume" min="0" max="100" value="50" class="slider">
            <span id="sfxVolVal" class="slider-val">50%</span>
          </div>
          <div class="setting-row">
            <label>Sound</label>
            <button id="settingsMuteBtn" class="toggle-btn" type="button">ON</button>
          </div>
        </div>
        <div class="setting-row" style="margin-top:0.5rem; border-top:1px solid var(--border); padding-top:1rem;">
          <label>Reset All Data</label>
          <button id="resetDataBtn" class="toggle-btn danger-btn" type="button">Reset</button>
        </div>
        <button id="settingsBackBtn" class="tiny" type="button">Back</button>
      </div>

      <!-- Tutorial / How to Play -->
      <div id="tutorialScreen" class="overlay">
        <p class="title">â“ How to Play</p>
        <div class="tutorial-content">
          <div class="tutorial-item">â¬…â¡ <b>Arrow Keys / A,D</b> â€” Rotate hexagon</div>
          <div class="tutorial-item">ğŸ¯ <b>Match 3</b> same-color blocks on a side to clear them</div>
          <div class="tutorial-item">â¤ï¸ <b>5 Lives</b> â€” Stack hits outer ring = lose a life</div>
          <div class="tutorial-item">ğŸ”¨ <b>Hammers</b> â€” Collect & press 1-6 to clear a side</div>
          <div class="tutorial-item">ğŸ’£ <b>Bomb</b> â€” Clears entire side instantly</div>
          <div class="tutorial-item">ğŸ¢ <b>Slow-Mo</b> â€” Slows blocks for 5 seconds</div>
          <div class="tutorial-item">ğŸ›¡ï¸ <b>Shield</b> â€” Protects from 1 life loss for 8 seconds</div>
          <div class="tutorial-item">âš¡ <b>Speed-Up</b> â€” Blocks fall faster (careful!)</div>
          <div class="tutorial-item">âš ï¸ <b>Penalty (purple)</b> â€” Deducts score</div>
          <div class="tutorial-item">ğŸ”’ <b>3 mistakes</b> â€” Rotation locks for 10s</div>
          <div class="tutorial-item">ğŸ¨ <b>New colors</b> appear at 3000 & 5000 score</div>
          <div class="tutorial-item">â­“ <b>Shape shifts</b> â€” The polygon changes shape at certain levels!</div>
          <div class="tutorial-item">â± <b>Time Chaser</b> â€” Race the clock for high score</div>
        </div>
        <button id="tutorialBackBtn" class="tiny" type="button">Back</button>
      </div>

      <!-- Achievements Screen -->
      <div id="achievementsScreen" class="overlay">
        <p class="title">ğŸ† Achievements</p>
        <div id="achievementsList" class="achievements-list"></div>
        <button id="achievementsBackBtn" class="tiny" type="button">Back</button>
      </div>

      <!-- Stats Screen -->
      <div id="statsScreen" class="overlay">
        <p class="title">ğŸ“Š Stats</p>
        <div class="stats-panel">
          <div class="stat-card"><span class="stat-value" id="statGamesPlayed">0</span><span class="stat-label">Games Played</span></div>
          <div class="stat-card"><span class="stat-value" id="statTotalScore">0</span><span class="stat-label">Total Score</span></div>
          <div class="stat-card"><span class="stat-value" id="statBestScore">0</span><span class="stat-label">Best Score</span></div>
          <div class="stat-card"><span class="stat-value" id="statTimePlayed">0m</span><span class="stat-label">Time Played</span></div>
          <div class="stat-card"><span class="stat-value" id="statMatchesCleared">0</span><span class="stat-label">Matches Cleared</span></div>
          <div class="stat-card"><span class="stat-value" id="statBestCombo">0</span><span class="stat-label">Best Combo</span></div>
        </div>
        <button id="statsBackBtn" class="tiny" type="button">Back</button>
      </div>

      <!-- Daily Challenge Screen -->
      <div id="dailyChallengeScreen" class="overlay">
        <p class="title">ğŸ“… Daily Challenge</p>
        <p class="subtitle" id="dailyChallengeDate"></p>
        <div class="daily-info-panel">
          <p class="daily-desc">Same challenge for everyone today!<br>Fixed seed â€¢ 90 seconds â€¢ Medium difficulty</p>
          <div class="daily-best-row">
            <span>Your Best Today:</span>
            <span class="daily-best-value" id="dailyBestScore">â€”</span>
          </div>
        </div>
        <button id="dailyPlayBtn" type="button">ğŸ¯ Play Today's Challenge</button>
        <button id="dailyChallengeBackBtn" class="tiny" type="button">Back</button>
      </div>

      <!-- Leaderboard Screen -->
      <div id="leaderboardScreen" class="overlay">
        <p class="title">â­ Leaderboard</p>
        <div class="leaderboard-tabs">
          <button class="tab-btn active" data-type="classic">Classic</button>
          <button class="tab-btn" data-type="multiplayer">Multiplayer</button>
        </div>
        <div id="leaderboardList" class="leaderboard-list"></div>
        <button class="tiny" id="leaderboardBackBtn" type="button">Back</button>
      </div>

      <!-- Game Center Info -->
      <div id="gameInfo" class="game-info" style="display:none;">
        <p id="infoText"></p>
      </div>
    </main>
  </div>

  <audio id="popSound" preload="auto"></audio>
  <audio id="hitSound" preload="auto"></audio>
  <audio id="powerupSound" preload="auto"></audio>
  <audio id="bgMusic" preload="auto" loop></audio>

  <script src="game.js"></script>
</body>
</html>
